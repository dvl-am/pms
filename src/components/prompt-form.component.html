<div class="prompt-form-container">
      <div class="form-header">
        <h2 class="form-title">{{ isEditMode ? 'Edit Prompt' : 'Create New Prompt' }}</h2>
        <p class="form-subtitle">{{ isEditMode ? 'Update prompt details and instructions' : 'Fill in the details to create a new prompt' }}</p>
      </div>

      <form [formGroup]="promptForm" (ngSubmit)="onSubmit()" class="prompt-form">
        <div class="form-grid">
          <!-- Version Number -->
          <div class="form-group">
            <label for="versionNumber" class="form-label">Version Number</label>
            <select 
              id="versionNumber" 
              formControlName="versionNumber" 
              class="form-select"
              [class.error]="promptForm.get('versionNumber')?.invalid && promptForm.get('versionNumber')?.touched">
              <option value="">Select version</option>
              <option *ngFor="let version of versionOptions" [value]="version">
                {{ version }}
              </option>
            </select>
            <div *ngIf="promptForm.get('versionNumber')?.invalid && promptForm.get('versionNumber')?.touched" 
                 class="error-message">
              Version number is required
            </div>
          </div>

          <!-- Process Stage -->
          <div class="form-group">
            <label for="processStage" class="form-label">Process Stage</label>
            <input 
              type="text" 
              id="processStage" 
              formControlName="processStage" 
              class="form-input"
              [class.error]="promptForm.get('processStage')?.invalid && promptForm.get('processStage')?.touched"
              placeholder="e.g., Content Generation, Code Review, Data Analysis">
            <div *ngIf="promptForm.get('processStage')?.invalid && promptForm.get('processStage')?.touched" 
                 class="error-message">
              Process stage is required
            </div>
          </div>
        </div>

        <!-- JSON Schema -->
         <div class="form-grid">
          <div class="form-group">
          <label for="jsonSchema" class="form-label">JSON Schema (Optional)</label>
          <p class="form-helper">Define the expected output structure in JSON Schema format</p>
          <textarea 
            id="jsonSchema" 
            formControlName="jsonSchema" 
            class="form-textarea json-schema"
            [class.error]="promptForm.get('jsonSchema')?.invalid && promptForm.get('jsonSchema')?.touched"
            rows="8"
            placeholder='{\n  "type": "object",\n  "properties": {\n    "result": {\n      "type": "string",\n      "description": "The generated result"\n    }\n  },\n  "required": ["result"]\n}'></textarea>
            
          <div *ngIf="promptForm.get('jsonSchema')?.invalid && promptForm.get('jsonSchema')?.touched" 
               class="error-message">
            <span *ngIf="promptForm.get('jsonSchema')?.errors?.['invalidJson']">Please enter valid JSON format</span>
          </div>
        </div>

        <div class="form-group">
          <label for="prompt" class="form-label">Prompt</label>
          <p class="form-helper">Define Prompt</p>
          <textarea 
            id="prompt" 
            formControlName="prompt" 
            class="form-textarea json-schema"
            [class.error]="promptForm.get('prompt')?.invalid && promptForm.get('prompt')?.touched"
            rows="8"
            placeholder='{\n  "type": "object",\n  "properties": {\n    "result": {\n      "type": "string",\n      "description": "The generated result"\n    }\n  },\n  "required": ["result"]\n}'></textarea>
            
          <div *ngIf="promptForm.get('prompt')?.invalid && promptForm.get('prompt')?.touched" 
               class="error-message">
            <span *ngIf="promptForm.get('prompt')?.errors?.['invalidJson']">Please enter valid JSON format</span>
          </div>
        </div>
         </div>
        

        <div class="form-grid">
          <div class="form-group">
          <label for="temperature" class="form-label">Temperature</label>
          <!-- <p class="form-helper">Define Prompt</p> -->
          <input type="text" 
            id="temperature" 
            formControlName="temperature" 
            class="form-input"
            [class.error]="promptForm.get('prompt')?.invalid && promptForm.get('prompt')?.touched"
            placeholder=''/>
        </div>

        <div class="form-group">
          <label for="topK" class="form-label">Top K</label>
          <!-- <p class="form-helper">Define Prompt</p> -->
          <input type="text" 
            id="topK" 
            formControlName="topK" 
            class="form-input"
            [class.error]="promptForm.get('prompt')?.invalid && promptForm.get('prompt')?.touched"
            placeholder=''/>
        </div>
        </div>

        <div class="form-grid">
          <div class="form-group">
          <label for="topP" class="form-label">Top P</label>
          <!-- <p class="form-helper">Define Prompt</p> -->
          <input type="text" 
            id="topP" 
            formControlName="topP" 
            class="form-input"
            [class.error]="promptForm.get('prompt')?.invalid && promptForm.get('prompt')?.touched"
            placeholder=''/>
        </div>

        <div class="form-group">
          <label for="maxOutputTokens" class="form-label">maxOutputTokens</label>
          <!-- <p class="form-helper">Define Prompt</p> -->
          <input type="text" 
            id="maxOutputTokens" 
            formControlName="maxOutputTokens" 
            class="form-input"
            [class.error]="promptForm.get('prompt')?.invalid && promptForm.get('prompt')?.touched"
            placeholder=''/>
        </div>
        </div>

        <div class="form-group">
          <label for="thinkingBudget" class="form-label">Thinking Budget</label>
          <!-- <p class="form-helper">Define Prompt</p> -->
          <input type="text" 
            id="thinkingBudget" 
            formControlName="thinkingBudget" 
            class="form-input"
            [class.error]="promptForm.get('prompt')?.invalid && promptForm.get('prompt')?.touched"
            placeholder=''/>
        </div>


        <!-- Instruction Paragraphs -->
        <div class="form-group">
          <label  class="form-label">Instructions</label>
          <div formArrayName="instructions" class="form-array">
            <div *ngFor="let paragraph of instructions.controls; let i = index" 
                 class="form-array-item">
              <div class="array-item-content">
                <div [formGroupName]="i">

              <div class="form-grid">
                <div class="form-group">
          <label for="paragraph" class="form-label">Paragraph</label>
          <!-- <p class="form-helper">Define Prompt</p> -->
          <textarea 
            id="paragraph" 
            formControlName="paragraph" 
            class="form-textarea json-schema"
            [class.error]="promptForm.get('prompt')?.invalid && promptForm.get('prompt')?.touched"
            rows="8"
            placeholder=''></textarea>            
            </div>


            <div class="form-group">
          <label for="guide" class="form-label">Guide</label>
          <!-- <p class="form-helper">Define Prompt</p> -->
          <textarea 
            id="guide" 
            formControlName="guide" 
            class="form-textarea json-schema"
            [class.error]="promptForm.get('prompt')?.invalid && promptForm.get('prompt')?.touched"
            rows="8"
            placeholder=''></textarea>            
            </div>
              </div>


              <div class="reason-form-group">

               <div class="form-group">
               <label for="reasonForChange" class="form-label">Reason for Edit</label>
                <input 
                  type="text"
                  formControlName="reasonForChange"
                  class="form-input"
                  
                  [placeholder]="'Edit reason '" />
               </div>
                 <div class="remove-form-array">
                <button 
                  type="button" 
                  class="remove-btn"
                  (click)="removeInstruction(i)"
                  [disabled]="instructions.length <= 1"
                  title="Remove paragraph">
                  ✕
                </button>
                 </div>
              </div>



                
              </div>
              </div>
              <!-- <div *ngIf="paragraph.invalid && paragraph.touched" 
                   class="error-message">
                Instruction paragraph is required
              </div> -->
            </div>
            <div class="add-int-group">
                <button 
              type="button" 
              class="add-btn"
              (click)="addInstructionToArray()">
              + Add Instruction
            </button>
            </div>
          </div>
          <!-- <div *ngIf="instructionParagraphsArray.invalid && instructionParagraphsArray.touched" 
               class="error-message">
            At least one instruction paragraph is required
          </div> -->
        </div>

        <!-- Instruction Guide -->
        <!-- <div class="form-group">
          <label for="instructionGuide" class="form-label">Instruction Guide</label>
          <p class="form-helper">Explain the meaning and purpose of this instruction</p>
          <div formArrayName="instructionGuide" class="form-array">
            <div *ngFor="let guide of instructionGuideArray.controls; let i = index" 
                 class="form-array-item">
              <div class="array-item-content">
                <textarea 
                  [formControlName]="i"
                  class="form-textarea"
                  [class.error]="guide.invalid && guide.touched"
                  rows="3"
                  [placeholder]="'Guide explanation ' + (i + 1) + '...'"></textarea>
                <button 
                  type="button" 
                  class="remove-btn"
                  (click)="removeInstructionGuide(i)"
                  [disabled]="instructionGuideArray.length <= 1"
                  title="Remove guide">
                  ✕
                </button>
              </div>
              <div *ngIf="guide.invalid && guide.touched" 
                   class="error-message">
                Instruction guide is required
              </div>
            </div>
            <button 
              type="button" 
              class="add-btn"
              (click)="addInstructionGuide()">
              + Add Instruction Guide
            </button>
          </div>
          <div *ngIf="instructionGuideArray.invalid && instructionGuideArray.touched" 
               class="error-message">
            At least one instruction guide is required
          </div>
        </div> -->

        <!-- Reason for Edit -->
        <div class="form-group" *ngIf="isEditMode">
          <label for="reasonForEdit" class="form-label">Reason for Edit</label>
          <div formArrayName="reasonForEdit" class="form-array">
            <div *ngFor="let reason of reasonForEditArray.controls; let i = index" 
                 class="form-array-item">
              <div class="array-item-content">
                <input 
                  type="text"
                  [formControlName]="i"
                  class="form-input"
                  [class.error]="reason.invalid && reason.touched"
                  [placeholder]="'Edit reason ' + (i + 1) + '...'">
                <button 
                  type="button" 
                  class="remove-btn"
                  (click)="removeReasonForEdit(i)"
                  [disabled]="reasonForEditArray.length <= 1"
                  title="Remove reason">
                  ✕
                </button>
              </div>
              <div *ngIf="reason.invalid && reason.touched" 
                   class="error-message">
                Reason for edit is required
              </div>
            </div>
            <button 
              type="button" 
              class="add-btn"
              (click)="addReasonForEdit()">
              + Add Edit Reason
            </button>
          </div>
          <div *ngIf="reasonForEditArray.invalid && reasonForEditArray.touched" 
               class="error-message">
            At least one reason for edit is required when updating
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button 
            type="button" 
            class="btn btn-secondary"
            (click)="onCancel()">
            Cancel
          </button>
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="promptForm.invalid || isSubmitting">
            <span *ngIf="isSubmitting" class="spinner"></span>
            {{ isEditMode ? 'Update Prompt' : 'Create Prompt' }}
          </button>
        </div>
      </form>
    </div>